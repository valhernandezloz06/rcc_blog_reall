<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Valeria Hernandez-Lozano">
<meta name="dcterms.date" content="2025-08-06">

<title>Nightmare patterns in Children – Valeria’s R portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-be4e5ecc5ba8ebc9794bd07940f43ae4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Valeria’s R portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://valhernandezloz06.github.io/rcc_blog_reall/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/MattCrumpLab"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Nightmare patterns in Children</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">data_science_sample_project</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Valeria Hernandez-Lozano </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 6, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/nightmareSleeping.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Nightmares are common phenomena that occur in early childhood. They are described as vivid and disturbing dreams that occur during the Rapid Eye Movement (REM) stage of sleep. It is often implied that these serve as an opening into a child’s creativity and thought process, as well as their emotional and psychological development.</p>
<p>In this project, I analyzed a data set in order to reveal the correlations and causes of nightmares in children aged 4 to 10. It is important to analyze this data to be aware of the psychological well-being of children during this early age of their development.</p>
<section id="research-questions-hypothesis" class="level1">
<h1><strong>Research Questions &amp; Hypothesis</strong></h1>
<section id="how-frequently-do-nightmares-occur-across-different-ages-4-10" class="level5">
<h5 class="anchored" data-anchor-id="how-frequently-do-nightmares-occur-across-different-ages-4-10"><strong>How frequently do nightmares occur across different ages (4-10)?</strong></h5>
<p><em><strong>Hypothesis</strong>:</em> Children over the age of 7 will experience nightmares more frequently than those under the age of 6, due to increased cognitive awareness, understanding, and emotional development.</p>
</section>
<section id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school" class="level5">
<h5 class="anchored" data-anchor-id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school">Are gender differences in nightmare frequency linked to psychological stress in school<strong>?</strong></h5>
<p><em><strong>Hypothesis</strong>:</em> There won’t be a significant difference in both nightmare frequency between boys and girls, and in psychological challenges at school, due to the young age of the individuals.</p>
</section>
<section id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content"><strong>Is there a relationship between recent life changes and nightmare content?</strong></h5>
<p><em><strong>Hypothesis</strong>:</em> Recent life events may cause stress or intense emotional and potentially traumatic responses, which may influence the emotional themes and content of their dreams. Specifically, I predict that those who experience their parents’ divorce may dream about losing someone, and those who experience moving houses may dream about being alone and lost.</p>
</section>
<section id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns"><strong>Is there a correlation between nightmare frequency and sleeping patterns?</strong></h5>
<p><em><strong>Hypothesis</strong>:</em> Children with irregular sleep schedules will experience nightmares more frequently, particularly on a weekly basis, due to a loss of emotional processing during REM sleep.</p>
</section>
</section>
<section id="approach" class="level1">
<h1>Approach</h1>
<p>The data set used in this analysis investigates the nightmares experienced by children aged 4 to 10 and their potential psychological effects. It was published by Atif Masih, a lecturer at Govt Islamia Graduate College, and was last updated in 2024. The data set has 12 variables (columns). These include 8 whose data is collected categorically: Age, Gender, Nightmare Frequency, Nightmare Content, Sleep Patterns, recent life changes, Sleep Environment, Parental observations, and 4 whose data is collected numerically: Psychological issues at school, Has Recent life Changes, Irregular Sleep Pattern, and Fear-Related Nightmares and there are a total of 20,000 participants ages 4-10.</p>
</section>
<section id="tools" class="level1">
<h1>Tools</h1>
<p>This analysis was conducted using <strong>RStudio</strong> in <strong>Posit.Cloud; GitHub</strong> and <strong>R</strong>, a programming language used for analysis, data visualization, and modeling. The data set was imported using the <strong>readr</strong> package and the <strong>read.csv()</strong> function, allowing access to the data set stored in CSV format.</p>
<p>To manipulate and visualize the data, I used packages from the <strong>tidyverse</strong>, such as <strong>ggplot2,</strong> for creating visualizations. The analysis included density plots, histograms, and bar charts, and data cleaning was conducted by filtering out N/A and Blank/Incomplete data using conditions like <strong>!is.na() and != ““</strong>.</p>
<p>Visual differences between my variables were made using <strong>color</strong> and <strong>fill</strong> aesthetics, and in certain graphs, I applied <strong>facet_wrap()</strong> to split plots into separate groups, allowing for a better comparison between specific conditions. Finally, to enhance the overall appearance of the plots, I included themes, titles, and appropriate x and y-axis names using <strong>labs() and theme_().</strong></p>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="how-frequently-do-nightmares-occur-across-different-ages-4-10-1" class="level5">
<h5 class="anchored" data-anchor-id="how-frequently-do-nightmares-occur-across-different-ages-4-10-1"><strong>How frequently do nightmares occur across different ages (4-10)?</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ stringr   1.5.1
✔ forcats   1.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Weekly nightmares are most common among children aged 4-5, while monthly and bi-weekly nightmares become more common between the ages of 7-10. This suggests that nightmares are less common as children grow older.</em></p>
</section>
<section id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school-1" class="level5">
<h5 class="anchored" data-anchor-id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school-1">Are gender differences in nightmare frequency linked to psychological stress in school<strong>?</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1616 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>Girls with higher Psychological problems at school show a higher count of weekly nightmares. In comparison, boys show a less notable change across the scale with a huge decrease in nightmares when approaching level 35.</em></p>
<p><em>In terms of monthly nightmares, both genders show similar patterns across the scale, with girls showing a higher count when approaching level 35 than boys.</em></p>
</section>
<section id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content-1" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content-1"><strong>Is there a relationship between recent life changes and nightmare content?</strong></h5>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>There is a suttle relationship between recent life changes and nightmare content seen due to different spikes in frequency across specific contents. For Instance, a child whose parents recently divorced reports dreaming about parents fighting, being trapped in space, losing body parts, and being attacked by animals. In comparison, those who recently moved to a new house tend to dream about being slapped by a parent, losing someone, finding monsters, and being alone and lost.</em></p>
</section>
<section id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns-1" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns-1"><strong>Is there a correlation between nightmare frequency and sleeping patterns?</strong></h5>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><em>There is no clear significant difference in sleeping patterns across weekly, bi-weekly, and monthly nightmare frequencies due to the bars being roughly evenly split between consistent and irregular sleep.</em></p>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<section id="was-my-hypothesis-supported" class="level6">
<h6 class="anchored" data-anchor-id="was-my-hypothesis-supported">Was my hypothesis supported?</h6>
</section>
<section id="how-frequently-do-nightmares-occur-across-different-ages-4-10-2" class="level5">
<h5 class="anchored" data-anchor-id="how-frequently-do-nightmares-occur-across-different-ages-4-10-2"><strong>How frequently do nightmares occur across different ages (4-10)?</strong></h5>
<p>My initial hypothesis was not supported. I predicted that children over the age of 7 would have nightmares more frequently than those under the age of 6; however, the data proved that nightmares are more common among children aged 4-5 and less common as they reach the age of 7. This has shifted my way of thinking, making me believe in my hypothesis less due to the clear proof that nightmare frequency decreases as children age.</p>
</section>
<section id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school-2" class="level5">
<h5 class="anchored" data-anchor-id="are-gender-differences-in-nightmare-frequency-linked-to-psychological-stress-in-school-2">Are gender differences in nightmare frequency linked to psychological stress in school<strong>?</strong></h5>
<p>My initial hypothesis was not supported. I predicted that there wouldn’t be a difference in nightmare frequency between boys and girls, and in psychological challenges at school, due to the young age of the children. However, the data depicted how, compared to boys, girls had nightmares more frequently when approaching level 35 of the psychological problems at school scale, showing stress-related nightmares. Due to these findings, there has been a change in my belief. Now I agree that there is a clear difference between the nightmare frequency and psychological stress levels experienced by boys and girls.</p>
</section>
<section id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content-2" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-relationship-between-recent-life-changes-and-nightmare-content-2"><strong>Is there a relationship between recent life changes and nightmare content?</strong></h5>
<p>My initial hypothesis was supported. Initially, I predicted that because of the potentially traumatic and vivid emotional stress caused by some of the children’s experiences, they may dream about specific contents in a consistent pattern. To give a clear example, I predicted that those who experience their parents’ divorce may dream about losing someone, and those who experience moving houses may dream about being alone and lost. Similarly, the figure described how a child whose parents recently divorced reports dreaming about parents fighting, being trapped in space, losing body parts, and being attacked by animals. In comparison, those who recently moved to a new house tend to dream about being slapped by a parent, losing someone, finding monsters, and being alone and lost.</p>
</section>
<section id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns-2" class="level5">
<h5 class="anchored" data-anchor-id="is-there-a-correlation-between-nightmare-frequency-and-sleeping-patterns-2"><strong>Is there a correlation between nightmare frequency and sleeping patterns?</strong></h5>
<p>My Initial hypothesis was not supported by the figure. I predicted that children with irregular sleep schedules would experience nightmares more frequently than those who have a consistent sleeping schedule. However, the figure shows that there is no clear significant difference in sleeping patterns across weekly, bi-weekly, and monthly nightmare frequencies. There has been no change in my initial belief, just because I don’t think it makes sense that inconsistent sleeping doesn’t affect the frequency of nightmares.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>